<system  name="FCS F15">
<!-- F-15 Flight controls 
	|  Richard Harrison: 2014-11-23 : rjh@zaretto.com - based on F-14 
   Longitudinal travel: -10 to 15cm
	-->

    <channel name="Mechanical">
        <fcs_function name="fcs/rudder-effectivity">
            <function>
                    <table>
                        <independentVar lookup="row">velocities/vc-kts</independentVar>
                        <tableData>
                            0.00 1.0
                            800 0.7
                        </tableData>
                    </table>
            </function>
        </fcs_function>
   </channel>

    <channel name="CAS longitudinal">
        <switch name="fcs/pitch-damper-active">
            <default value="0.0" />
            <test logic="AND" value="1">
                fcs/elevator-cmd-norm ge -0.15
                fcs/elevator-cmd-norm le 0.15
                fcs/cas-pitch-enable ne 0.0
            </test>
            <output>fcs/pitch-damper-active</output>
        </switch>

        <scheduled_gain name="fcs/pitch-damper-rate">
            <!-- Figure 2-57 F14AAD-1  -->
            <input>velocities/q-aero-rad_sec</input>
            <table>
                <independentVar lookup="row">velocities/ve-kts</independentVar>
                <tableData>
                    30 0.00
                    60 1
                </tableData>
            </table>
            <gain>fcs/pitch-damper-active</gain>
            <min> -0.2857142857142857 </min>
            <max> 0.2857142857142857 </max>
        </scheduled_gain>

    </channel>
    
    <channel name="Pitch">
		<summer name="fcs/pitch-stick-trimmed">
			<input>fcs/pitch-trim-cmd-norm</input>
			<input>fcs/elevator-cmd-norm</input>
		</summer>
		<fcs_function name="fcs/pitch-stick-scheduled">
			<description>
				Longitudinal position adjusted for position instead of force
				(fig 17 - NASA TM 72861)
			</description>
			<function>
				<table>
					<independentVar lookup="row">fcs/pitch-stick-trimmed</independentVar>
					<tableData>
						-1.000 -1.00000
						-0.188 -0.06729
						-0.001  0.00000
						 0.003  0.00000
						 0.351  0.19635
						 1.000  1.00000
					</tableData>
				</table>
			</function>
		</fcs_function>
		<fcs_function name="fcs/pitch-trim-compensation">
			<!-- this is a 3 part function
                   base values
                   - deltas for gear
                   - deltas for flaps
            -->
            <function>
                <product>
                    <v>1</v>
                    <description>PTC PRESET ELEVATOR TRIM(DEGREES) DUE TO AIRSPEED AND MAC% F(VC, MAC%)</description>
                    <sum>
						<!-- PTC PRESET ELEVATOR TRIM(DEGREES) DUE TO AIRSPEED AND MAC% F(VC, MAC%) -->
                        <table>
                            <independentVar lookup="row">velocities/vc-kts</independentVar>
                            <independentVar lookup="column">inertia/cg-x-mac-percent</independentVar>
                            <tableData>
                                             20        20.5          21        21.5          22        22.5          23        23.5          24
                                  0    0.000000    0.000000    0.000000    0.000000    0.000000    0.000000    0.000000    0.000000    0.000000
                                200   -0.222270   -0.222450   -0.228983   -0.244722   -0.273146   -0.174354   -0.161585   -0.141665   -0.141665
                                250   -0.130184   -0.130167   -0.131723   -0.143852   -0.157158   -0.097033   -0.091520   -0.088460   -0.088460
                                300   -0.081073   -0.081589   -0.083858   -0.089115   -0.090965   -0.060288   -0.055246   -0.051484   -0.051484
                                350   -0.041472   -0.039374   -0.041562   -0.045228   -0.030029   -0.030701   -0.024068   -0.007630   -0.007630
                                400   -0.005571   -0.005793   -0.006567   -0.009482   -0.008097    0.000238    0.000490   -0.091142   -0.091142
                                450   -0.089492   -0.009026   -0.037256    0.009159   -0.010570   -0.014307    0.041271    0.077493    0.077493
                                500   -0.001433   -0.017378    0.003975    0.017936    0.001710    0.019385   -0.048416   -0.003933   -0.003933
                                550    0.005941    0.005865    0.004781    0.003436    0.002097    0.008851    0.009415    0.009179    0.009179
                                600    0.007333    0.007319    0.006506    0.004324    0.002039    0.010335    0.010754    0.011601    0.011601
                                650    0.008539    0.008577    0.007756    0.006156    0.001042    0.011200    0.011478    0.012558    0.014850
                                700    0.009650    0.009592    0.008659    0.008208   -0.000520    0.012253    0.012234    0.013363    0.015417
                                750    0.010604    0.010639    0.009652    0.008640   -0.000261    0.013003    0.013216    0.013684    0.015810
                                800    0.011343    0.011484    0.010651    0.009110    0.000741    0.013402    0.013718    0.014097    0.018045
                                850    0.012020    0.011978    0.011257    0.010100    0.002525    0.013404    0.014234    0.005660    0.018137
                                900    0.012484    0.012571    0.011734    0.010210    0.002257    0.014227    0.014565    0.011387    0.011881
                                950    0.016950    0.016950    0.016950    0.016950    0.004375    0.023752    0.022349    0.020946    0.019544
                                1000    0.017255    0.017255    0.017255    0.017074    0.017542    0.018216    0.018889    0.019563    0.020236
                                1050    0.017623    0.017623    0.017565    0.017419    0.017982    0.018546    0.019109    0.019673    0.020236
                                1100    0.017846    0.017842    0.018017    0.018201    0.018440    0.019031    0.019625    0.020220    0.020814
                                1150    0.018443    0.018443    0.018443    0.018443    0.018443    0.018609    0.018764    0.018839    0.019496
                            </tableData>
                        </table>
						<!-- PTC PRESET ELEVATOR TRIM(DEGREES) GEAR INCREMENT DUE TO AIRSPEED AND MAC% F(VC, MAC%) -->
                        <product>
                            <p>gear/gear-position-norm</p>
                            <table>
                                <independentVar lookup="row">velocities/vc-kts</independentVar>
                                <independentVar lookup="column">inertia/cg-x-mac-percent</independentVar>
                                <tableData>
                                                 20         20.5           21         21.5           22         22.5           23         23.5           24
                                    190    0.000000    0.000000    0.000000    0.000000    0.000000    0.000000    0.000000    0.000000    0.000000
                                    200   -0.057384   -0.056855   -0.070603   -0.064928   -0.112958   -0.006502    0.005116    0.013112   -0.023732
                                    250    0.029321    0.030634    0.028793    0.014894    0.005362    0.065875    0.069981    0.081584    0.081584
                                    300    0.078087    0.078496    0.079067    0.071542    0.068644    0.100251    0.103509    0.112294    0.112294
                                    350    0.105494    0.104643    0.102054    0.102304    0.111595    0.120472    0.123647    0.124443    0.124443
                                    400    0.273051    0.273051    0.273051    0.273051    0.273051    0.148868    0.152145    0.152145    0.152145
                                    450    0.019112    0.019112    0.019112    0.019112    0.019112    0.019112    0.019112    0.019112    0.019112
                                    460    0.000000    0.000000    0.000000    0.000000    0.000000    0.000000    0.000000    0.000000    0.000000
                                </tableData>
                            </table>
                        </product>
						<!-- PTC PRESET ELEVATOR TRIM(DEGREES) FLAP INCREMENT DUE TO AIRSPEED AND MAC% F(VC, MAC%) -->
                        <product>
                            <p>fcs/flap-pos-norm</p>
                            <table>
                                <independentVar lookup="row">velocities/vc-kts</independentVar>
                                <independentVar lookup="column">inertia/cg-x-mac-percent</independentVar>
                                <tableData>
                                                 20         20.5           21         21.5           22         22.5           23         23.5           24
                                    190    0.000000    0.000000    0.000000    0.000000    0.000000    0.000000    0.000000    0.000000    0.000000
                                    200    0.104391    0.102040    0.103712    0.082305    0.083971    0.158905    0.169480    0.237372    0.237372
                                    250    0.191331    0.192080    0.190929    0.183699    0.179046    0.230864    0.231986    0.252363    0.252363
                                    300    0.238591    0.238660    0.236781    0.233391    0.225150    0.258934    0.262219    0.271478    0.271478
                                    350    0.252602    0.252602    0.251550    0.248406    0.245113    0.245113    0.245113    0.245113    0.245113
                                    360    0.000000    0.000000    0.000000    0.000000    0.000000    0.000000    0.000000    0.000000    0.000000
                                </tableData>
                            </table>
                        </product>
                    </sum>
                </product>
            </function>
        </fcs_function>

		<fcs_function name="fcs/pitch-ratio-calc-0">
			<description>
				RJH: 
					Pitch Ratio: 
					- - - - - - - - - - -  - - - - - - - 
					This device adjusts the amount of collective (pitch)
					stabilator deflection available for a given longitudinal stick
					motion.  The ratio is scheduled to produce essentially the same
					stick travel per "g" throughout the flight envelope.  Since the
					longitudinal feel system is just a simple spring cartridge, this
					then relates to a constant stick force per "g" (Fs/g) (about 4.25
					lb/g).  It is scheduled by Mach number and altitude and does a
					rather good job; however, it won't quite cover the full range of
					aircraft and stabilator power and there is some scatter of the
					Fs/g, i.e., some mild increase in sensitivity during low
					altitude/high speed flight, and some decrease in sensitivity at
					low speeds.
				
				This is based on a description of how the pitch ratio works, together with  Tuned based on aircraft performance; mostly standard day. 
				
				ref: NASA TM 72861 : Precision controllability of the F-15 airplane
				
				ref: F-15 Flight Control System Part IV - Longitudinal Control, 
					By B. P. "PERRY" HOFFMAN/Senior Engineer, 
					Flight Control Section, Avionics Engineering Laboratories, 
					https://www.f15sim.com/operation/f15_longitudinal_control.html
					
					PRCA 
					- - - - - - - - - - -  - - - - - - - 
					To begin with, let's break the PRCA pitch channel into its
					components (Figure 2) and see how each affects the longitudinal
					controls. The input rod offers two linkage paths with the main path
					tying directly into the ratio changer linkage, and a second input
					being supplied to the Load Factor Sensor portion of the Pitch Trim
					Controller.
					
					Pitch Ratio Changer
					- - - - - - - - - - -  - - - - - - - 
					The pitch ratio changer utilizes dual redundant
					parallelogram linkage identical in operation to the roll ratio changer
					described in our last DIGEST article on lateral controls. The only
					operational difference is that the pitch ratio changer gearing
					utilizes a 6:1 ratio, where the roll ratio changer utilizes a 4:1
					ratio.
					
					Pitot (Pt) and static (Ps) information is supplied from the left-hand
					probe to the ratio controller bellows assembly, repositioning a
					cam-operated valve supplying hydraulic pressure to the ratio changer
					actuator. The ratio changer actuator then drives the changer linkage,
					varying the stick-to-stabilator gearing as required.
					
					If hydraulics are lost to the PRCA, or if the pilot selects the EMERC
					position of the pitch ratio changer by actuation of the Pitch Ratio
					switch, the pitch ratio changer will drive to its failed position. In
					the failed mode, the gearing ratio is one-half of its maximum value
					and all other functions (PTC and Boost) are inoperative.
					
					Two additional functions are associated with the ratio changer (one is
					no longer used, but a note of explanation is in order in case you see
					it on a schematic diagram). Early in the program there was a gear down
					valve which drove the pitch ratio changer to maximum (for landing
					control) when the nose gear proximity switch actuated. The
					disadvantages seemed to outweigh the advantages, so the valve has been
					deactivated on current Eagles and the valve will not be in future
					PRCA's. For the maintenance man, this is a great help since he can
					simply place the Pitch Ratio switch to emergency and check the fail
					mode without having to simulate a gear up condition.
					
					The second function is a safety feature controlled by the pitch ratio
					changer actuator. If a hardover failure of the pitch trim controller
					occurs at low pitch ratios, the pitch CAS is inoperative, longitudinal
					control could be lost. To guard against this possibility, a valve
					within the ratio changer actuator is opened when the actuator
					approaches the minimum ratio position. This valve supplies hydraulic
					pressure to an interlock piston within the pitch trim compensator,
					keeping it at a position where adequate control is always available.
					
					The output of the pitch ratio changer is fed to the pitch boost
					actuator servo valve. The boost actuator output is mechanically linked
					back to the servo valve input, closing the loop. The boost actuator
					output also feeds the downstream linkage, which deflects the
					stabilators and drives the linkage scheduling the roll ratio
					controller and the ARI. As you will recall from our previous articles,
					the pitch output is used in roll to schedule the roll ratio as a
					function of angle of attack. Yaw is affected by this also, since yaw
					gain increases as roll gain decreases. No more rudder rolls, guys; all
					you need for high angle of attack
                    
                    2019-08-17 : retuned with new PTC; it's now around 8g at all airspeeds (where there
                                 is sufficient energy to sustain this)
                    2019-08-18 : based on a better understanding of the above the PRCA is now a simple
                                 1:1 at low qbar going to 1:6 at high qbar.
                                 Values of low and high qbar are somewhat estimated based on 800kts
                                 "pitch ratio changer gearing utilizes a 6:1 ratio" 
                                    ref: https://www.f15sim.com/operation/f15_longitudinal_control.html
			</description>
			<function>
				<table>
					<independentVar lookup="row">aero/qbar-psf</independentVar>
					<tableData>
                        300  1.00000
                        1300 0.16667
                    </tableData>
				</table>
			</function>
			<clipto>
				<min>0.166667</min>
				<max>1.0</max>
			</clipto>
		</fcs_function>
		<fcs_function name="fcs/pitch-ratio-calc-1">
            <function>
                <table>
                    <independentVar lookup="row">inertia/cg-x-mac-percent</independentVar>
                    <tableData>
                        0.15 0.90
                        0.25 1.0
                    </tableData>
                </table>
            </function>
            <clipto>
                <min>0.65</min>
                <max>1.0</max>
            </clipto>
        </fcs_function>

        <fcs_function name="fcs/pitch-ratio-calc">
            <function>
                <product>
                    <p>fcs/pitch-ratio-calc-0</p>
                    <p>fcs/pitch-ratio-calc-1</p>
                </product>
            </function>
        </fcs_function>

        <switch name="fcs/pitch-ratio">
			<default value="fcs/pitch-ratio-calc"/>
			<test logic="OR" value="0.5">
				systems/hydraulics/flight-system-pressure ne 1
				fcs/pitch-ratio-emergency ne 0
			</test>
		</switch>
		<pure_gain name="fcs/pitch-stick-adjusted">
            <input>fcs/pitch-stick-scheduled</input>
			<gain>fcs/pitch-ratio</gain>
		</pure_gain>
        <summer name="fcs/pitch-trim-sum">
			<input>fcs/pitch-stick-adjusted</input>
			<input>fcs/pitch-trim-compensation</input>
            <input>fcs/pitch-damper-rate</input>
            <input>systems/afcs/elevator-cmd-delta</input>
        </summer>  

        <switch name="fcs/pitch-ratio">
            <default value="fcs/pitch-ratio" />
            <test value="fcs/pitch-ratio-emergency-value" logic="OR">
                fcs/pitch-ratio-emergency ne 0
            </test>
            <test value="1" logic="OR">
                gear/gear-position-norm ne 0
            </test>
        </switch>

         <fcs_function name="fcs/roll-ratio-dmd">
            <function>
                <sum>
                    <property>fcs/roll-ratio-base</property>
                    <product>
                        <property>velocities/vc-kts</property>
                        <property>fcs/roll-ratio-factor</property>
                    </product>
                </sum>
            </function>
            <clipto>
                <min>0.25</min>
                <max>1.0</max>
            </clipto>
        </fcs_function>

        <switch name="fcs/roll-ratio">
            <description>Roll ratio actual</description>
            <default value="fcs/roll-ratio-dmd" />
            <test value="0.5" logic="OR">
                fcs/roll-ratio-emergency ne 0
            </test>
            <test value="1" logic="OR">
                gear/gear-position-norm ne 0
            </test>
        </switch>
    </channel>

    <channel name="CAS Lateral">
        <switch name="fcs/roll-cas-active">
            <default value="0.0" />
            <test logic="AND" value="1">
                fcs/cas-roll-enable ne 0.0
            </test>
            <output>fcs/roll-cas-active</output>
        </switch>

        <switch name="fcs/yaw-damper-active">
            <default value="0.0" />
            <test logic="AND" value="1">
                fcs/roll-cas-active ne 0.0
            </test>
            <output>fcs/yaw-damper-active</output>
        </switch>
        <fcs_function name="fcs/yaw-damper-factor-c1">
            <function>
                <table>
                    <independentVar>velocities/vc-kts</independentVar>
                    <tableData>
                        200 50
                        250 100
                        600 600
                        700 1200
                        1000 1200
                    </tableData>
                </table>
            </function>
        </fcs_function>
        <fcs_function name="fcs/yaw-damper-sum-v0">
            <function>
                <product>
                    <property>velocities/r-aero-rad_sec</property>
                    <property>fcs/yaw-damper-factor</property>
                    <not>
                        <property>position/aircraft-on-ground</property>
                    </not>
                    <table>
                        <independentVar>velocities/vc-kts</independentVar>
                        <tableData>
                             0     0.00
                            80     0.00
                           100     0.00
                           105     1.00
                           200     6.00
                           300     2.00
                           400     2.00
                           600     1.00
                           700     0.80
                           800     0.60
                           999     0.60
                        </tableData>
                    </table>
                </product>
            </function>
            <clipto>
                <min>-1.2000</min>
                <max>1.2000</max>
            </clipto>
        </fcs_function>
        <lag_filter name="fcs/yaw-damper-sum-v">
            <input>fcs/yaw-damper-sum-v0</input>
            <c1>fcs/yaw-damper-factor-c1</c1>
        </lag_filter >
        <lead_lag_filter name="fcs/yaw-damper-sum">
            <input>fcs/yaw-damper-sum-v</input>
            <c1>2</c1>
            <c2>0</c2>
            <c3>2</c3>
            <c4>1</c4>
        </lead_lag_filter >

        <pure_gain name="fcs/yaw-damper-dmd">
            <input>fcs/yaw-damper-sum</input>
            <gain>fcs/yaw-damper-active</gain>
        </pure_gain>

        <scheduled_gain name="fcs/roll-rate-limiter">
            <input>fcs/aileron-cmd-scheduled</input>
            <table>
                <independentVar lookup="row">velocities/p-aero-rad_sec</independentVar>
                <tableData>
                    -6.2 -1.0
                    -1.4  0.0
                     1.4  0.0
                     6.2 -1.0
                </tableData>
            </table>
            <gain>fcs/roll-cas-active</gain>
        </scheduled_gain>
        <summer name="fcs/roll-cas-output">
			<input>fcs/roll-rate-limiter</input>
		</summer>

    </channel>
    
    <channel name="Pitch">
        <summer name="Pitch Trim Sum">
            <input>fcs/elevator-cmd-norm</input>
            <input>fcs/pitch-trim-cmd-norm</input>
            <input>fcs/pitch-damper-rate</input>
            <input>systems/afcs/elevator-cmd-delta</input>
            <input>fcs/pitch-trim-compensation</input>
            <clipto>
                <min> -1 </min>
                <max> 1 </max>
            </clipto>
        </summer>

        <switch name="fcs/pitch-trim-actuator">
            <default value="fcs/pitch-trim-sum"/>
            <test value="fcs/pitch-trim-actuator">
                systems/hydraulics/flight-system-pressure ne 1
            </test>
        </switch>

        <aerosurface_scale name="fcs/elevator-pos-raw-demand">
            <input>fcs/pitch-trim-actuator</input>
			<!-- maybe this should take into account the trim limits from the AAP -->
            <range>
                <min> -0.50877 </min>
                <max> 0.26315 </max>
            </range>
        </aerosurface_scale>

        <pure_gain name="fcs/elevator-pos-demand">
            <input>fcs/elevator-pos-raw-demand</input>
            <gain>fcs/pitch-ratio</gain>
        </pure_gain>

        <kinematic name="elevator position">
            <input>fcs/elevator-pos-demand</input>
            <traverse>
                <setting>
                    <position>-1</position>
                    <time>0.9</time>
                </setting>
                <setting>
                    <position>1</position>
                    <time>0.90</time>
					<!-- based on 30 deg/sec -->
                </setting>
            </traverse>
            <output>fcs/elevator-pos-rad</output>
        </kinematic>

		<!-- dtd is washed out with elevator position http://www.f15sim.com/operation/f15_lat_control.html -->
        <fcs_function name="fcs/differential-elevator-pos-norm">
            <function>
                <product>
                    <property>fcs/aileron-right-pos-norm</property>
                    <value>0.3</value> <!-- mxaimum authority -->
                    <table>
						<!-- Figure 4 Mechanmical lateral control authority.
      ** iv; Vc Kts
      ** stabilator maximum
      ** dv: full stock aileron deflection degrees
-->
                        <independentVar lookup="row">fcs/elevator-pos-deg</independentVar>
                        <independentVar lookup="column">velocities/vc-kts</independentVar>
                        <tableData>
                            635.0 664.3 668.2 714.8 741.3 768.0 794.7
                            -24 0.16 0.16 0.16 0.16 0.16 0.16 0.16
                            -23 0.16 0.16 0.16 0.16 0.16 0.16 0.16
                            -22 0.16 0.16 0.16 0.16 0.16 0.15 0.16
                            -21 0.16 0.16 0.16 0.16 0.16 0.15 0.16
                            -20 0.16 0.16 0.16 0.16 0.16 0.15 0.16
                            -19 0.16 0.16 0.16 0.16 0.16 0.15 0.16
                            -18 0.19 0.19 0.20 0.20 0.19 0.19 0.19
                            -17 0.29 0.30 0.30 0.30 0.30 0.29 0.24
                            -16 0.39 0.40 0.40 0.40 0.40 0.38 0.24
                            -15 0.50 0.50 0.51 0.50 0.50 0.38 0.24
                            -14 0.60 0.60 0.61 0.61 0.50 0.38 0.24
                            -13 0.70 0.70 0.71 0.63 0.50 0.38 0.24
                            -12 0.80 0.81 0.75 0.63 0.50 0.38 0.24
                            -11 0.91 0.87 0.75 0.63 0.50 0.38 0.25
                            -10 1.00 0.87 0.75 0.63 0.50 0.38 0.25
                            -9 1.00 0.87 0.75 0.63 0.50 0.38 0.25
                            -8 1.00 0.87 0.75 0.63 0.50 0.38 0.25
                            -7 1.00 0.88 0.75 0.63 0.50 0.38 0.25
                            -6 1.00 0.88 0.75 0.63 0.50 0.38 0.25
                            -5 1.00 0.88 0.75 0.63 0.50 0.38 0.25
                            -4 0.90 0.88 0.75 0.63 0.50 0.38 0.25
                            -3 0.79 0.80 0.75 0.63 0.50 0.38 0.25
                            -2 0.69 0.69 0.69 0.63 0.50 0.38 0.25
                            -1 0.58 0.59 0.59 0.59 0.50 0.38 0.25
                            0 0.47 0.49 0.48 0.49 0.48 0.38 0.25
                            1 0.37 0.39 0.38 0.40 0.38 0.38 0.25
                            2 0.26 0.28 0.27 0.30 0.28 0.28 0.25
                            3 0.25 0.25 0.24 0.25 0.25 0.24 0.25
                            4 0.25 0.25 0.24 0.25 0.24 0.24 0.25
                            5 0.25 0.25 0.24 0.25 0.24 0.24 0.25
                            6 0.24 0.25 0.24 0.25 0.24 0.24 0.25
                            7 0.24 0.25 0.24 0.25 0.24 0.24 0.25
                            8 0.24 0.25 0.24 0.25 0.24 0.24 0.25
                            9 0.24 0.25 0.24 0.25 0.24 0.24 0.25
                            10 0.24 0.25 0.24 0.25 0.24 0.24 0.25
                            11 0.24 0.25 0.24 0.25 0.24 0.24 0.25
                            12 0.24 0.24 0.24 0.24 0.24 0.24 0.25
                            13 0.24 0.24 0.24 0.24 0.24 0.24 0.25
                            14 0.24 0.24 0.24 0.24 0.24 0.24 0.25
                            15 0.24 0.24 0.24 0.24 0.24 0.24 0.24
                            16 0.24 0.24 0.24 0.24 0.24 0.24 0.24
                        </tableData>
						<!--<independentVar lookup="row">fcs/elevator-pos-deg</independentVar>
                        <tableData>
                            -24     0
                              0     0.3
                             16     0
                        </tableData>-->
                    </table>
                </product>
            </function>
        </fcs_function>
        <summer name="fcs/elevator-left-pos-norm">
            <input>fcs/elevator-pos-norm</input>
            <input>fcs/differential-elevator-pos-norm</input>
        </summer>
        <summer name="fcs/elevator-right-pos-norm">
            <input>fcs/elevator-pos-norm</input>
            <input>-fcs/differential-elevator-pos-norm</input>
        </summer>
                        <aerosurface_scale name="fcs/differential-elevator-pos-deg">
            <input>fcs/differential-elevator-pos-norm</input>
            <domain>
                <min> -1 </min>
                <max> 1 </max>
            </domain>
            <range>
                <min> -6.66667 </min>
                <max> 6.66667 </max>
            </range>
        </aerosurface_scale>

        <aerosurface_scale name="elevator normalization">
            <input>fcs/elevator-pos-rad</input>
            <domain>
                <min> -0.57895 </min>
                <max> 0.21053 </max>
            </domain>
            <range>
                <min> -1 </min>
                <max>  1 </max>
            </range>
            <output>fcs/elevator-pos-norm</output>
        </aerosurface_scale>
    </channel>


	<!-- aileron: +/- 5deg : +/- 33 deg/sec -->
    <channel name="Roll">

        <summer name="fcs/aileron-cmd-norm-trimmed">
            <property>fcs/roll-trim-cmd-norm</property>
            <input>fcs/aileron-cmd-norm</input>
        </summer>

        <fcs_function name="fcs/aileron-cmd-scheduled">
            <description>
                Lateral position adjusted for position instead of force (fig 19 - NASA TM 72861)
            </description>
            <function>
                <table>
                    <independentVar lookup="row">fcs/aileron-cmd-norm-trimmed</independentVar>
                    <tableData>
                        -1.0000    -1.0000
                        -0.5670    -0.5108
                        -0.3960    -0.2888
                        -0.0532     0.0000
                         0.0000     0.0000
                         0.0532     0.0000
                         0.3960     0.2888
                         0.5670     0.5108
                         1.0000     1.0000
                    </tableData>
                </table>
            </function>
        </fcs_function>

        <summer name="fcs/roll-trim-sum-raw">
            <input>fcs/aileron-cmd-scheduled</input>
            <input>fcs/roll-cas-output</input>
            <clipto>
                <min> -1 </min>
                <max> 1 </max>
            </clipto>
        </summer>

        <pure_gain name="fcs/roll-trim-sum-norm">
            <input>fcs/roll-trim-sum-raw</input>
            <gain>fcs/roll-ratio</gain>
        </pure_gain>

        <switch name="fcs/roll-trim-actuator-norm">
            <default value="fcs/roll-trim-sum-norm"/>
            <test value="fcs/roll-trim-actuator-norm">
                systems/hydraulics/flight-system-pressure ne 1
            </test>
        </switch>

        <kinematic name="aileron position">
            <input>fcs/roll-trim-actuator-norm</input>
            <traverse>
                <setting>
                    <position>-1</position>
                    <time>0.9</time>
                </setting>
                <setting>
                    <position>1</position>
                    <time>0.90</time>
					<!-- based on 30 deg/sec -->
                </setting>
            </traverse>
            <output>fcs/aileron-pos-norm</output>
        </kinematic>

        <aerosurface_scale name="Aileron Control">
            <input>fcs/aileron-pos-norm</input>
            <range>
                <min> -0.34910106475824751265491359748647</min>
                <max> 0.34910106475824751265491359748647</max>
            </range>
            <output>fcs/aileron-pos-rad</output>
        </aerosurface_scale>

        <pure_gain name="fcs/aileron-left-pos-rad">
            <input>fcs/aileron-pos-rad</input>
            <gain>1</gain>
            <output>fcs/aileron-left-pos-rad</output>
        </pure_gain>

        <pure_gain name="fcs/aileron-right-pos-rad">
            <input>fcs/aileron-pos-rad</input>
            <gain>1</gain>
        </pure_gain>

        <pure_gain name="fcs/aileron-left-pos-norm">
            <input>fcs/aileron-pos-norm</input>
            <gain>1</gain>
        </pure_gain>
        <pure_gain name="fcs/aileron-right-pos-norm">
            <input>fcs/aileron-pos-norm</input>
            <gain>1</gain>
        </pure_gain>

        <pure_gain name="fcs/aileron-right-pos-deg">
            <input>fcs/aileron-right-pos-rad</input>
            <gain>30</gain>
        </pure_gain>
        <pure_gain name="fcs/aileron-left-pos-deg">
            <input>fcs/aileron-left-pos-rad</input>
            <gain>30</gain>
        </pure_gain>
        <pure_gain name="fcs/aileron-pos-deg">
            <input>fcs/aileron-right-pos-rad</input>
            <gain>30</gain>
        </pure_gain>

        <aerosurface_scale name="left aileron normalization">
            <input>fcs/left-aileron-pos-rad</input>
            <domain>
                <min> -0.22807 </min>
                <max> 0.22807 </max>
            </domain>
            <range>
                <min> -1 </min>
                <max> 1 </max>
            </range>
            <output>fcs/left-aileron-pos-norm</output>
        </aerosurface_scale>

        <aerosurface_scale name="Aileron Control">
            <input>fcs/right-aileron-pos-norm</input>
            <range>
                <min> -20 </min>
                <max> 20 </max>
            </range>
            <output>fcs/aileron-pos-deg</output>
        </aerosurface_scale>

        <aerosurface_scale name="Left Aileron Control">
            <input>fcs/aileron-pos-norm</input>
            <range>
                <min> -0.22807 </min>
                <max> 0.22807 </max>
            </range>
            <output>fcs/left-aileron-pos-rad</output>
        </aerosurface_scale>

        <aerosurface_scale name="Right Aileron Control">
            <input>fcs/aileron-pos-norm</input>
            <range>
                <min> -0.22807 </min>
                <max> 0.22807 </max>
            </range>
            <output>fcs/right-aileron-pos-rad</output>
        </aerosurface_scale>

        <aerosurface_scale name="left aileron normalization">
            <input>fcs/left-aileron-pos-rad</input>
            <domain>
                <min> -0.22807 </min>
                <max> 0.22807 </max>
            </domain>
            <range>
                <min> -1 </min>
                <max> 1 </max>
            </range>
            <output>fcs/left-aileron-pos-norm</output>
        </aerosurface_scale>

        <aerosurface_scale name="right aileron normalization">
            <input>fcs/right-aileron-pos-rad</input>
            <domain>
                <min> -0.22807 </min>
                <max> 0.22807 </max>
            </domain>
            <range>
                <min> -1 </min>
                <max> 1 </max>
            </range>
            <output>fcs/right-aileron-pos-norm</output>
        </aerosurface_scale>

        <aerosurface_scale name="Aileron Control">
            <input>fcs/right-aileron-pos-norm</input>
            <range>
                <min> -20 </min>
                <max> 20 </max>
            </range>
            <output>fcs/aileron-pos-deg</output>
        </aerosurface_scale>

    </channel>

    <channel name="Yaw">

		<!-- rudder limits +/-30deg 40 deg/sec-->
		<!-- stabilizer limits +/7deg 30 deg/sec-->
		<!--<fcs_function name="fcs/ari-longitudinal-rudder-demand-norm">
            <description>ARI</description>
            <function>
                <table>
                    <independentVar lookup="row">fcs/elevator-pos-deg</independentVar>
                    ?? or stick position ??
                    <tableData>
                        -30     0.1
                        0     0
                        30     -0.1
                    </tableData>
                </table>
            </function>
            <clipto>
                <min> -0.1 </min>
                <max>  0.1 </max>
            </clipto>
        </fcs_function>-->
        <fcs_function name="fcs/ari-lateral-rudder-demand-norm">
            <!--This is the amount of rudder per inch of lateral stick. 
                NASA-TM-72861, Figure 23
                The tables have been normalized on inches of stick movement, based on my understanding that there is about 4inches of stick deflection.-->
            <description>ARI</description>
            <function>
                <product>
                    <property>fcs/aileron-cmd-scheduled</property>
                    <property>fcs/ari-lateral-enabled</property>
                    <table>
                        <independentVar lookup="row">fcs/elevator-pos-deg</independentVar>
                        <independentVar lookup="column">fcs/flap-pos-deg</independentVar>
                        <tableData>
                                      0       30
                            -24  -0.923   -0.818
                              0  -0.105    0.000
                             15   0.406    0.511
                        </tableData>
                    </table>
                </product>
            </function>
            <clipto>
                <min> -1.0 </min>
                <max> 1.0 </max>
            </clipto>
        </fcs_function>

		<!-- http://www.f15sim.com/operation/f15_flight_control_system.htm -->
        <switch name="fcs/ari-lateral-rudder-pos-norm">
            <default value="fcs/ari-lateral-rudder-demand-norm"/>
            <test value="0">
                velocities/mach ge 0.9
            </test>
            <test value="0" logic="OR">
                velocities/mach ge 0.9
                position/aircraft-on-ground ne 0
            </test>
        </switch>

        <summer name="fcs/rudder-command-raw-sum">
            <input>fcs/rudder-cmd-norm</input>
            <input>fcs/yaw-trim-cmd-norm</input>
            <input>fcs/ari-lateral-rudder-pos-norm</input>
            <clipto>
                <min> -1 </min>
                <max> 1 </max>
            </clipto>
        </summer>
        <pure_gain name="fcs/rudder-command-sum">
            <input>fcs/rudder-command-raw-sum</input>
            <gain>fcs/rudder-effectivity</gain>
        </pure_gain>

        <summer name="fcs/rudder-pos-norm">
            <input>fcs/rudder-command-sum</input>
            <input>fcs/yaw-damper-dmd</input>
            <clipto>
                <min> -1.1 </min>
                <max> 1.1 </max>
            </clipto>
        </summer>

        <switch name="fcs/rudder-pos-norm-0">
            <default value="fcs/rudder-pos-norm"/>
            <test value="fcs/rudder-pos-norm-0">
                systems/hydraulics/flight-system-pressure ne 1
            </test>
        </switch>
        <lead_lag_filter name="fcs/rudder-pos-norm">
            <input>fcs/rudder-pos-norm-0</input>
            <c1>0</c1>
            <c2>20</c2>
            <c3>1</c3>
            <c4>20</c4>
        </lead_lag_filter>
	
        <pure_gain name="fcs/rudder-pos-deg">
            <input>fcs/rudder-pos-norm</input>
            <gain>30</gain>
        </pure_gain>
    </channel>

    <channel name="Flaps">
        <switch name="fcs/flap-total-dmd">
            <default value="0"/>
            <test value="fcs/flap-total-dmd">
                systems/hydraulics/combined-system-pressure ne 1
            </test>
            <test value="fcs/flap-cmd-norm">
                fcs/flap-cmd-norm ne 0
                systems/hydraulics/combined-system-pressure ne 0
            </test>
            <clipto>
                <min> 0 </min>
                <max> 1 </max>
            </clipto>
            <output>fcs/flap-total-dmd</output>
        </switch>

        <kinematic name="Flaps Control">
            <input>fcs/flap-total-dmd</input>
            <traverse>
                <setting>
                    <position> 0 </position>
                    <time> 0 </time>
                </setting>
                <setting>
                    <position> 30 </position>
                    <time>    1.944</time>
                </setting>
            </traverse>
            <output>fcs/flap-pos-deg</output>
        </kinematic>

        <aerosurface_scale name="flap normalization">
            <input>fcs/flap-pos-deg</input>
            <domain>
                <min> 0 </min>
                <max> 30 </max>
            </domain>
            <range>
                <min> 0 </min>
                <max> 1 </max>
            </range>
            <output>fcs/flap-pos-norm</output>
        </aerosurface_scale>


    </channel>

    <channel name="Landing Gear">
		<!-- landing gear;
1. Switch up down
2. emergency handle

- normal operation (emergency handle retracted).
  : requires hyds
  : cannot retract on ground
  
  parts:
    uplock
    downlock
    door
    bogeys
    
    uplock downlock modelled as single lock -ve for downlock 0 for unlocked, 1 for uplocked
    
emerg operation.
: handle pulled. hyds & electrics cut
-->

		<!-- Deplete the JFS store-->
        <switch name="systems/hydraulics/emerg-gear-unlocked">
            <default value="0"/>
            <test value="1">
                systems/hydraulics/util-system-accumulator-psi gt 200
                gear/emergency-handle gt 0.7
                gear/unit[0]/locked ne 0
            </test>
            <test value="systems/hydraulics/emerg-gear-unlocked">
                gear/emergency-handle gt 0.7
            </test>
        </switch>
        <switch name="systems/hydraulics/emerg-gear-bleed">
            <default value="0"/>
            <test value="10000">
                systems/hydraulics/emerg-gear-unlocked ne 0
                gear/unit[0]/locked ne 0
            </test>
        </switch>

        <switch name="gear/unit[0]/locked">
            <default value="-1"/>
            <test value="0">
                systems/hydraulics/emerg-gear-unlocked ne 0
				<!-- unlocked when handle pulled -->
                gear/emergency-handle gt 0.7
                gear/emerg-pos lt 1
            </test>
            <test value="0">
				<!-- unlocked. -->
                gear/unit[0]/pos-norm gt 0
              gear/unit[0]/pos-norm lt 1
            </test>
            <test value="1">
                gear/unit[0]/pos-norm le 0
            </test>
            <test value="-1">
                gear/unit[0]/pos-norm ge 1
            </test>
        </switch>
        <switch name="gear/unit[1]/locked">
            <default value="-1"/>
            <test value="0">
				<!-- unlocked when handle pulled -->
				<!-- should deplete the JFS store-->
                gear/emergency-handle gt 0.7
                gear/emerg-pos lt 1
            </test>
            <test value="0">
				<!-- unlocked. -->
                gear/unit[1]/pos-norm gt 0
                gear/unit[1]/pos-norm lt 1
            </test>
            <test value="1">
                gear/unit[1]/pos-norm le 0
            </test>
            <test value="-1">
                gear/unit[1]/pos-norm ge 1
            </test>
        </switch>
        <switch name="gear/unit[2]/locked">
            <default value="-1"/>
            <test value="0">
				<!-- unlocked when handle pulled -->
				<!-- should deplete the JFS store-->
                gear/emergency-handle gt 0.7
                gear/emerg-pos lt 1
            </test>
            <test value="0">
				<!-- unlocked. -->
                gear/unit[2]/pos-norm gt 0
                gear/unit[2]/pos-norm lt 1
            </test>
            <test value="1">
                gear/unit[2]/pos-norm le 0
            </test>
            <test value="-1">
                gear/unit[2]/pos-norm ge 1
            </test>
        </switch>
        <switch name="gear/emerg-pos">
            <default value="gear/emerg-pos-dmd"/>
        </switch>
        <fcs_function name="gear/emerg-pos-dmd">
            <function>
                <ifthen>
                    <and>
                        <ge>
                            <property>gear/emergency-handle</property>
                            <value>0.9</value>
                        </ge>
                        <or>
                            <eq>
                                <property>gear/unit[0]/locked</property>
                                <value>-1.0</value>
                            </eq>
                            <and>
                                <eq>
                                    <property>contact/unit[9]/WOW</property>
                                    <value>0</value>
                                </eq>
                                <eq>
                                    <property>contact/unit[10]/WOW</property>
                                    <value>0</value>
                                </eq>
                            </and>
                        </or>
                    </and>
                    <sum>
                        <property>gear/emerg-pos</property>
                        <ifthen><not><eq><property>gear/unit[0]/locked</property><value>1.0</value></eq></not>
                            <table>
                                <independentVar lookup="row">gear/emerg-pos</independentVar>
                                <independentVar lookup="column">accelerations/Nz</independentVar>
                                <tableData>
                                                 -3.0     0.0     0.5     1.0     1.2     2.0     5.0    10.0
                                    -0.00001  0.00000 0.00100 0.00000 0.00090 0.00090 0.00090 0.00090 0.00400
                                     0.0     -0.00400 0.00000 0.00000 0.00090 0.00090 0.00090 0.00090 0.00400
                                     0.90     0.00000 0.00000 0.00000 0.00090 0.00090 0.00090 0.00090 0.00400
                                     0.98     0.11000 0.00000 0.00000 0.00000 0.00000 0.09000 0.11090 0.00400
                                     1.0      0.00000 0.00000 0.00000 0.00090 0.00090 0.00090 0.00090 0.00400
                                 </tableData>
                            </table>
                            <value>0</value>
                        </ifthen>
                    </sum>
                    <value>0</value>
                </ifthen>
            </function>
        </fcs_function>

        <switch name="gear/unit[0]/damaged">
            <default value="gear/unit[0]/damaged"/>
            <test logic="AND" value="0">
                gear/damage-reset ne 0
            </test>
                <test logic="AND" value="1">
                position/aircraft-on-ground ne 0
                position/aircraft-on-ground-last-value ne position/aircraft-on-ground
                velocities/h-dot-fps le -20
                gear/unit[0]/WOW ne 0
            </test>
        </switch>
        <switch name="gear/unit[1]/damaged">
            <default value="gear/unit[1]/damaged"/>
            <test logic="AND" value="0">
                gear/damage-reset ne 0
            </test>
            <test logic="AND" value="1">
                position/aircraft-on-ground ne 0
                position/aircraft-on-ground-last-value ne position/aircraft-on-ground
                velocities/h-dot-fps le -20
                gear/unit[1]/WOW ne 0
            </test>
        </switch>
        <switch name="gear/unit[2]/damaged">
            <default value="gear/unit[2]/damaged"/>
            <test logic="AND" value="0">
                gear/damage-reset ne 0
            </test>
            <test logic="AND" value="1">
                position/aircraft-on-ground ne 0
                position/aircraft-on-ground-last-value ne position/aircraft-on-ground
                velocities/h-dot-fps le -20
                gear/unit[2]/WOW ne 0
            </test>
        </switch>
        <switch name="Gear Unit 0 Z">
            <default value="-77.6496063"/>
            <test value="-20">
                gear/unit[0]/damaged eq 1
            </test>
            <output>gear/unit[0]/z-position</output>
        </switch>
        <switch name="Gear Unit 1 Z">
            <default value="-84.3385827"/>
            <test value="-30">
                gear/unit[1]/damaged eq 1
            </test>
            <output>gear/unit[1]/z-position</output>
        </switch>
        <switch name="Gear Unit 2 Z">
            <default value="-84.3385827"/>
            <test value="-30">
                gear/unit[2]/damaged eq 1
            </test>
            <output>gear/unit[2]/z-position</output>
        </switch>

        <switch name="Contact Unit 3 Z nose door">
            <default value="-30.6496063"/>
            <test value="-55">
                gear/unit[0]/damaged eq 1
            </test>
            <output>contact/unit[3]/z-position</output>
        </switch>
        <switch name="Contact Unit 4 Z nose door">
            <default value="-30"/>
            <test value="-55">
                gear/unit[1]/damaged eq 1
            </test>
            <output>contact/unit[4]/z-position</output>
        </switch>
        <switch name="Contact Unit 5 Z nose door">
            <default value="-30"/>
            <test value="-55">
                gear/unit[2]/damaged eq 1
            </test>
            <output>contact/unit[5]/z-position</output>
        </switch>
        <switch name="tied/aircraft-on-ground-last-value">
            <default value="position/aircraft-on-ground"/>
            <output>position/aircraft-on-ground-last-value</output>
			<!--<test value="1">
            position/aircraft-on-ground ne 0
        </test>-->
        </switch>

		<!--Gear that is damaged will be shown as half retracted; which will look kind of broken. These
        three functions set the gear position based on the damage to the appropriate value-->
        <fcs_function name="tied/fcs-gear-0-pos-norm">
            <function>
                <ifthen>
                    <gt>
                        <p>gear/unit[0]/damaged</p>
                        <v>0</v>
                    </gt>
                    <v>0.5</v>
                    <p>gear/gear-position-norm</p>
                </ifthen>
            </function>
          <output>gear/unit[0]/pos-norm</output>
        </fcs_function>

        <fcs_function name="tied/fcs-gear-1-pos-norm">
            <function>
                <ifthen>
                    <gt>
                        <p>gear/unit[1]/damaged</p>
                        <v>0</v>
                    </gt>
                    <v>0.5</v>
                    <p>gear/gear-position-norm</p>
                </ifthen>
            </function>
          <output>gear/unit[1]/pos-norm</output>
        </fcs_function>
        
        <fcs_function name="tied/fcs-gear-2-pos-norm">
            <function>
                <ifthen>
                    <gt>
                        <p>gear/unit[2]/damaged</p>
                        <v>0</v>
                    </gt>
                    <v>0.5</v>
                    <p>gear/gear-position-norm</p>
                </ifthen>
            </function>
          <output>gear/unit[2]/pos-norm</output>
        </fcs_function>
		<!--End of gear damage handling-->

        <switch name="tied/gear-dmd-norm">
            <default value="1"/>
            <test value="1">
				<!-- always force gear down when on ground - to prevent inadvertant retraction -->
              position/aircraft-on-ground ne 0
            </test>
            <test value="gear/emerg-pos">
                gear/emergency-handle ne 0
            </test>
            <test value="gear/gear-position-norm">
                gear/serviceable ne 1
                gear/emergency-handle lt 1
            </test>
            <test value="gear/gear-dmd-norm">
                systems/hydraulics/combined-system-pressure ne 1
            </test>
            <test value="gear/gear-cmd-norm">
                systems/hydraulics/combined-system-pressure ne 0
            </test>
            <clipto>
                <min> 0 </min>
                <max> 1 </max>
            </clipto>
            <output>gear/gear-dmd-norm</output>
        </switch>

        <kinematic name="Gear Control">
            <input>gear/gear-dmd-norm</input>
            <traverse>
                <setting>
                    <position> 0 </position>
                    <time> 0 </time>
                </setting>
                <setting>
                    <position> 1 </position>
                    <time>     1.8 </time>
                </setting>
            </traverse>
            <output>gear/gear-position-norm</output>
        </kinematic>
    </channel>

    <channel name="Speedbrake">
        <switch name="fcs/speedbrake-dmd-norm">
            <default value="0"/>
            <test value="fcs/speedbrake-dmd-norm">
                systems/hydraulics/combined-system-pressure ne 1
            </test>
            <test value="fcs/speedbrake-cmd-norm">
                systems/hydraulics/combined-system-pressure ne 0
            </test>
            <clipto>
                <min> 0 </min>
                <max> 1 </max>
            </clipto>
            <output>fcs/speedbrake-dmd-norm</output>
        </switch>

        <kinematic name="Speedbrake Control">
            <input>fcs/speedbrake-dmd-norm</input>
            <traverse>
                <setting>
                    <position> 0 </position>
                    <time> 0 </time>
                </setting>
                <setting>
                    <position> 1 </position>
                    <time>     1.5 </time>
                </setting>
            </traverse>
            <output>fcs/speedbrake-pos-norm</output>
        </kinematic>
    </channel>

    <channel name="Hook">
        <kinematic name="fcs/hook-control">
            <input>fcs/hook-engage</input>
            <traverse>
                <setting>
                    <position>0</position>
                    <time>0</time>
                </setting>
                <setting>
                    <position>1</position>
                    <time>2.5</time>
                </setting>
            </traverse>
            <output>fcs/hook-pos-norm</output>
        </kinematic>
    </channel>
</system>
